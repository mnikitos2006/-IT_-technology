# Lesson2

### Браузерное окружение, спецификации

Сегодня JavaScript может использоваться в браузере, на веб-сервере или в какой-то другой среде, даже в кофеварке. Каждая
среда предоставляет свою функциональность, которую спецификация JavaScript называет окружением.
Окружение предоставляет свои объекты и дополнительные функции, в дополнение базовым языковым. Браузеры, например, дают
средства для управления веб-страницами. Node.js делает доступными какие-то серверные возможности и так далее.

В браузере существует корневой объект window, который выполняет несколько ролей

1) Является глобальным объектом для JS кода
2) Представляет собой окно браузера и располагает методами для управления им.

## DOM (Document Object Model)

Document Object Model, сокращённо DOM - объектная модель документа, представляющая все содержимое страницы в виде
объектов, которые можно менять.

Объект `document` - основная "входная точка". При помощи этого объекта мы можем изменять элементы на странице, создавать
их или удалять.

Например:

```js run
// заменим цвет фона на красный,
document.body.style.background = "red";

// а через секунду вернём как было
setTimeout(() => document.body.style.background = "", 1000);
```

Мы использовали в примере только `document.body.style`, но таких возможностей намного больше. Различные свойства и
методы описаны в спецификации:

- **DOM Living Standard** на <https://dom.spec.whatwg.org>

## BOM (Browser Object Model)

Объектная модель браузера (Browser Object Model, BOM) - это дополнительные объекты, предоставляемые браузером (
окружением), чтобы работать со всем, кроме документа.

Например:

- Объект [navigator](mdn:api/Window/navigator) даёт информацию о самом браузере и операционной системе. Среди множества
  его свойств самыми известными являются: `navigator.userAgent` -- информация о текущем браузере,
  и `navigator.platform` -- информация о платформе (может помочь в понимании того, в какой ОС открыт браузер --
  Windows/Linux/Mac и так далее).
- Объект [location](mdn:api/Window/location) позволяет получить текущий URL и перенаправить браузер по новому адресу.

Вот как мы можем использовать объект `location`:

```js run
alert(location.href); // показывает текущий URL
if (confirm("Перейти на Wikipedia?")) {
    location.href = "https://wikipedia.org"; // перенаправляет браузер на другой URL
}
```

Функции `alert/confirm/prompt` тоже являются частью BOM: они не относятся непосредственно к странице, но представляют
собой методы объекта окна браузера для коммуникации с пользователем.

## Итого

Говоря о стандартах, у нас есть:

Спецификация DOM
: Описывает структуру документа, манипуляции с контентом и события, подробнее на <https://dom.spec.whatwg.org>.

Спецификация CSSOM
: Описывает файлы стилей, правила написания стилей и манипуляций с ними, а также то, как это всё связано со страницей,
подробнее на <https://www.w3.org/TR/cssom-1/>.

Спецификация HTML
: Описывает язык HTML (например, теги) и BOM (объектную модель браузера) -- разные функции
браузера: `setTimeout`, `alert`, `location` и так далее, подробнее на <https://html.spec.whatwg.org>. Тут берётся за
основу спецификация DOM и расширяется дополнительными свойствами и методами.

## DOM- дерево

Основа HTML-документа - теги.

В соответствии с DOM(объектной моделью документа) каждый тег - это объект. Вложенные теги будут детьми(children)
родительского элемента.
Текст, находящийся внутри элемента также является объектом.

Для изменения или взаимодействия с этими объектами мы используем JS.

ПРИМЕР

Для того чтобы обратится к тегу <body> напишем следующий код:

```js
document.body //получили доступ к боди
```

Для изменения цвета у тега боди:

```js
document.body.style.background = "red"// получили доступ к боди, обратились к свойству style, затем в style обртились к background и присвоили значение "red"
```

Еще раз убеждаемся, что работаем с элементами DOM как с обычным объектом.

```js
//работу с дом надо представлять как работу с объектом
const window = {
    document: {
        body: {
            style: {
                background: "red"
            }
        }
    }
}
```

Все что есть в HTML будет в дом дереве. Лишние пробелы, переносы , комментарии.
Чтобы посмотреть структуру ДОМ можно воспользоваться инструментами разработчика браузера.
Нужно открыть инструмент, перейти на вкладку Elements.
Или выбрать интересующий нас элемент на странице, 
кликнуть правой клавишей мыши и нажать просмотреть код(В разных
браузерах называется по разному)

### Навигация по DOM - элементам.

Дом позволяет нам делать любые манипуляции с элементами и их содержимым, 
но для этого нужно сначала получить доступ к
этому элементу, то-есть найти его и получить.

Все операции с DOM начинаются с главной точки входа с `document`.

<html> = document.documentElement
<body> = document.body
<head> = document.head

document.body может быть равен null, то есть быть пустым, если мы обратимся к нему раньше,
чем браузер его прочитал.

```html
<!doctype html>
<html lang="en">
<head>
    <script>
        console.log(document.body) // выведет null так как body еще не существует
    </script>
</head>
<body>
<script>
    console.log(document.body) // В этом месте будет все хорошо
</script>
</body>
</html>
```

### Дети и потомки

1) Дочерние узлы или дети: элементы которые являются непосредственными детьми узла
2) Потомки - все элементы, которые лежат внутри данного элемента.

```html

<html>
<body>
<div>1</div>
<ul>
    <li>
        <b>2</b>
    </li>
</ul>
</body>
</html>
```

<div> и  <ul> являются детьми тега <body>.
А потомки <body> это все что лежит внутри.

Для того чтобы получить коллекцию всех детей можно обратиться к коллекции childNodes.

```html

<html>
<body>
<div>Начало</div>

<ul>
    <li>Информация</li>
</ul>

<div>Конец</div>

<script>
    for (let i = 0; i < document.body.childNodes.length; i++) {
        alert(document.body.childNodes[i]); // Text, DIV, Text, UL, ..., SCRIPT
    }
</script>
...какой-то HTML-код...
</body>
</html>
```

### DOM - коллекции

1) Для перебора коллекции можем использовать for...of
2) Методы массивов работать не будут, потому что коллекция это не массив
3) Если очень нужно воспользоваться методами массивов можем создать массив из коллекции Array.from()

```js
console.log(Array.from(document.body.childNodes).filter)
```

- DOM коллекции только для чтения
- DOM- коллекции живые
- не используйте for...in(перебирает абсолютно все свойства)

### Соседи и родитель

- <body> – «следующий» или «правый» сосед <head>
-  <head> «предыдущий» или «левый» сосед <body>
- Родитель доступен через parentNode

### Навигация только по элементам

Используя childNodes к нам в работу попадет все то что будет в HTML комментарии, текст и пр.
Если нам нужна навигация только по элементам то мы должны обращаться:
- children – коллекция детей, которые являются элементами.
- firstElementChild, lastElementChild – первый и последний дочерний элемент.
- previousElementSibling, nextElementSibling – соседи-элементы.
- parentElement – родитель-элемент.

```html

<html>
<body>
<div>Начало</div>

<ul>
    <li>Информация</li>
</ul>

<div>Конец</div>

<script>
    for (let elem of document.body.children) {
        alert(elem); // DIV, UL, DIV, SCRIPT
    }
</script>
...
</body>
</html>
```

Цикл выводит только элементы пропуская текстовые узлы.

Почитать https://learn.javascript.ru/browser-environment
Почитать https://learn.javascript.ru/dom-nodes
Почитать https://learn.javascript.ru/dom-navigation
